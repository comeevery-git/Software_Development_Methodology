#### 2부. 모델 주도 설계의 기본 요소

### 4장. 도메인의 격리
> 도메인에서 발생하는 문제를 해결하는 소프트웨어의 각 요소는, 그것의 중요성에 어울리지 않게 대개 전체 소프트웨어 시스템의 극히 작은 부분을 구성한다.
> 
> 그러한 요소에 가장 적절한 생각을 반영하려면 모델의 구성요소를 살펴보고 그것들을 하나의 시스템으로 바라볼 수 있어야 한다.
> 
> 시스템에서 도메인과 관련이 적은 기능으로부터 도메인 객체를 분리할 필요가 있으며, 
> 그렇게 해서 도메인 개념을 다른 소프트웨어 기술에만 관련된 개념과 혼동하거나, 
> 또는 시스템이라는 하나의 큰 덩어리 안에서 도메인을 전혀 바라보지 못하는 문제를 방지할 수 있다.


---


### 계층형 아키텍쳐(Layered Architecture)
> 사용자 인터페이스 (또는 표현) 계층
> - 사용자에게 정보를 보여주고 사용자의 명령을 해석하는 일을 책임진다. (다른 컴퓨터 시스템이 외부 행위자가 되기도 한다)
> 
> 응용 계층
> - 소프트웨어가 수행할 작업을 정의하고 표현력 있는 도메인 객체가 문제를 해결하게 한다.
> - 이 계층에서 책임지는 작업은 어무상 중요하거나 다른 시스템의 응용 계층과 상호작용하는 데 필요한 것들이다.
> - 이 계층은 얇게 유지된다. 여기에는 업무 규칙이나 지식이 포함되지 않으며, 오직 작업을 조정하고 아래에 위치한 계층에 포함된 도메인 객체의 협력자에게 작업을 위임한다.
> - 이 계층에서는 업무 상황을 반영하는 상태가 없지만 사용자나 프로그램의 작업에 대한 진행상황을 반영하는 상태를 가질 수는 있다.
> 
> 도메인 (또는 모델) 계층
> - 업무 개념과 업무 상황에 관한 정보, 업무 규칙을 표현하는 일을 책임진다.
> - 이 계층에서는 업무 상황을 반영하는 상태를 제어하고 사용하며, 그와 같은 상태 저장과 관련된 기술적인 세부사항은 인프라스트럭쳐에 위임한다.
> - 이 계층은 업무용 소프트웨어의 핵심이다.
> 
> 인프라스트럭쳐
> - 상위 계층을 지원하는 일반화된 기술적 기능을 제공한다.
> - 이러한 기능에는 애플리케이션에 대한 메시지 전송, 도메인 영속화, UI에 위젯을 그리는 것 등이 있다.
> - 또한 인프라스트럭쳐 계층은 아키텍쳐 프레임워크를 통해 네 가지 계층에 대한 상호작용 패턴을 지원할 수도 있다.

- 계층형 아키텍쳐는 도메인을 격리하는 가장 일반적인 방법이다.

- 매우 복잡한 작업을 처리하는 소프트웨어를 만들 경우 `관심사의 분리(Seperation of Concerns)`를 통해 복잡성을 줄이는 것이 중요하다.
  - 관심사의 분리란 서로 다른 관심사를 가진 요소들을 분리하는 것을 의미한다.
  - 이로써 격리된 상태에 있는 각 설계 요소에 집중할 수 있다.

[//]: # (  - 동시에 시스템 내의 정교한 상호작용은 그러한 분리와는 상관없이 유지돼야 한다.)

- 계층화의 핵심 원칙은 한 계층의 모든 요소는 오직 같은 계층에 존재하는 다른 요소나 계층상 `아래`에 위치한 요소에만 의존한다는 것이다.
  - 위로 거슬러 올라가는 의사소통은 반드시 간접적인 메커니즘을 거쳐야 한다. (추후 설명)

[//]: # (- 각 측면에서는 더욱 응집력 있는 설계가 가능해지며, 이로써 설계를 훨씬 더 쉽게 이해할 수 있다.)


---


### 도메인 계층의 분리
> MODEL-DRIVEN DESIGN을 가능케 하는 것은 결정적으로 `도메인 계층`을 분리하는 데 있다.

1. 복잡한 프로그램을 여러 개의 계층으로 나눠라.
2. 응집력 있고 오직 아래에 위치한 계층에만 의존하는 각 계층에서 설계를 발전시켜라.
3. 표준 아키텍쳐 패턴에 따라 상위 계층과의 결합을 느슨하게 유지하라. 
4. 도메인 모델과 관련된 코드는 모두 한 계층에 모으고 사용자 인터페이스 코드나 애플리케이션 코드, 인프라스트럭쳐 코드와 격리하라.
5. 도메인 객체(표현이나 저장, 애플리케이션 작업을 관리하는 등의 책임에서 자유로운)는 도메인 모델을 표현하는 것에만 집중할 수 있다.
- 이로써 모델은 진화를 거듭해 본질적인 업무 지식을 포착해서 해당 업무 지식이 효과를 발휘할 수 있을 만큼 풍부하고 명확해질 것이다.


---


### 계층 간 관계 설정
- 각 계층은 설계 의존성을 오직 한 방향으로만 둬서 느슨하게 결합된다.
  - 상위 계층은 하위 계층의 공개 인터페이스를 호출하고 하위 계층에 대한 참조를 가지며, 일반적으로 관례적인 상호작용 수단을 이용해 하위 계층의 구성요소를 직접적으로 사용하거나 조작할 수 있다.
    - 그러나 하위 수준의 객체가 상위 수준의 객체와 소통해야 할 경우에는(직접적인 질의에 응답하는 것 이상으로) 또 다른 매커니즘이 필요하다.
      - 이 경우 콜백(callback)이나 Observer 패턴 처럼 계층 간에 관계를 맺어주는 아키텍쳐 패턴을 사용할 수 있다.
- 응용 계층과 도메인 계층에 UI를 연결하는 패턴은 MVC에서 유래한다.


---


### 도메인 계층은 모델이 살아가는 곳
- 레이어드 아키텍쳐는 오늘날 대부분의 시스템에서 다양한 계층화 계획하에 사용되며, 여러 개발 방식도 이러한 계층화의 혜택을 얻을 수 있다.
  - 하지만 도메인 주도 설계에서는 오직 한 가지 특정한 계층만이 존재할 것을 요구한다.
- `도메인 모델`은 일련의 개념을 모아놓은 것이다.
  - `도메인 계층`은 그러한 모델과 설계 요소에 직접적으로 관계돼 있는 모든 것들을 명시한 것이다.
    - 도메인 계층은 업무 로직에 대한 설계와 구현으로 구성된다.
    - MODEL-DRIVEN DESIGN에서는 도메인 계층의 소프트웨어 구성물이 모델의 개념을 반영한다.
- 도메인 주도 설계의 전제 조건은 도메인 구현을 격리하는 것이다.


---


### SMART UI(지능형 UI) 안티 패턴
- SMART UI란?
  - 애플리케이션에서 데이터의 입력과 표시에 영향을 받고 비즈니스 로직은 UI에 작성되는 것을 말한다.
    - UI에서 관계형 DB에 직접적으로 상호작용한다.
    - UI가 스마트 하다는 건 UI에 비즈니스 로직이 있고 인프라에 직접적으로 접근하는 한마디로 계층 구분이 없는 코드를 의미한다.
    - UI에서 계산도 하고 DB에 접근도 할 수 있다.
- 레이어드 아키텍쳐와 함께 MODEL-DRIVEN DESIGN을 적용한다면 험악한 학습 곡선에 직면할 것이다.
  - 팀원들은 복잡한 신기술에 통달해야 하고 객체 모델링을 학습하는 과정에서 차질을 빚게 될 것이다.
  - 인프라 스트럭쳐 계층을 관리하는 데 따르는 부하 탓에 매우 단순한 과업을 수행하는 데조차 시간이 오래 걸린다.
- 모든 업무 로직을 사용자 인터페이스에 넣어라.
  - 애플리케이션을 작은 기능으로 잘게 나누고, 나눈 기능을 각기 분리된 사용자 인터페이스로 구현해서 업무 규칙을 분리된 사용자 인터페이스에 들어가게 하라.
  - 관계형 데이터베이스를 데이터의 공유 저장소로 사용하고 이용 가능한 최대한 자동화된 UI구축 도구와 시각적인 프로그래밍 도구를 사용하라.

> 바로 `도메인`과 `UI`를 분리해야 한다는 것이다.
> 
> 장점
> 1. 애플리케이션이 단순한 경우 생산성이 높고 효과가 즉각적으로 나타난다.
> 2. 학습곡선이 낮다.
> 3. 요구사항 분석 단계에서 결함이 발생하더라도 사용자에게 프로토타입을 배포한 후 요구에 맞게 제품을 변경해서 문제를 해결할 수 있다.
> 4. 애플리케이션이 서로 분리되므로 규모가 작은 모듈의 납기 일정을 비교적 정확하게 계획할 수 있다. 시스템을 확장하기가 수월할 수 있다.
> 등..
> 
> 단점
> 1. 데이터베이스를 이용하는 방식 말고는 여러 애플리케이션을 통합하기가 수월하지 않다.
> 2. 행위를 재사용하지 않으며 업무 문제에 대한 추상화가 이뤄지지 ㅇ낳는다. 업무 규칙이 적용되는 연산만다 업무 규칙이 중복된다.
> 3. 추상화의 부재로 리팩터링의 여지가 제한된다.(신속한 프로토타입 작성과 반복주기가 한계에 도달한다)
> 4. 복잡성에 금방 압도되어 애플리케이션의 성장 경로가 순전히 부가적인 단순 응용으로만 향한다.
- 언어에 가장 적합한 개발 도구를 선택해야 한다.

- SMART UI는 도메인 계층을 격리하는 데 레이어드 아키텍쳐와 같은 패턴이 왜, 그리고 언제 필요한지를 분명하게 짚고 넘어가고자 살펴본 것에 불과하다.
- MODEL-DRIVEN DESIGN을 하기로 했다면 고통을 감내하고 필요한 전문가를 확보하며 SMART UI를 피해야 한다.
- 결론은 아키텍쳐에서 응집력 있는 도메인 설계가 시스템의 다른 부분과 느슨하게 결합될 수 있도록
  - 도메인 관련 코드를 격리한다면, 아마 도메인 주도 설계를 지원할 수 있을 것이다.


---

